{{!-- Sweet Alert JS --}}
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  let deleteBtns = document.querySelectorAll('.deleteBtn');
  for (let btn of deleteBtns) {
    btn.addEventListener('click', async function (event) {
      // Suppress default behavior of element
      event.preventDefault();
    
      // Choose either variant or product to delete, product/variant passed into target "variable"
      const toRemove = "{{target}}"; 
      let title = `${event.target.dataset.item} will be removed. Do you want to continue with this action?`;
      // Removal message
      if(toRemove == "product"){
        title = `${event.target.dataset.productitem} will be removed. Do you want to continue with this action?`
      }
      

      const result = await Swal.fire({
        'title': title,
        'icon': 'error',
        'confirmButtonText': 'Yes delete',
        'cancelButtonText': 'No cancel',
        'showCloseButton': true,
        'showCancelButton': true
      });


      // The next line in the function will only execute after the user has clicked one of the buttons
      if (result.isConfirmed) {
        // Process the delete operation (the only way to redirect browser to a POST route is by submitting an empty form)
        const form = document.createElement('form');
        form.method = 'post';
        
        form.action = `/products/${event.target.dataset.productid}/variants/${event.target.dataset.variantid}/delete`
        form.innerHTML = <input type = "hidden" value="{{csrfToken}}" name="_csrf"/>
        if(toRemove == 'product') {
          form.action = `/products/${event.target.dataset.productid}/delete`;
        }

        //form.action = `/products/${event.target.dataset.productId}/delete`;
        
        
        document.querySelector('body').appendChild(form); // Connect hidden form to document body
        form.submit(); // Submit delete form with a function call
      }
    })
  }
</script>